<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loading Priorities Scanner Bookmarklet</title>
    <style>
        body {
            max-width: 600px;
            font-family: Arial, Helvetica, sans-serif;
            color: #333;
        }
        a.button {
            display: inline-block;
            border: 1px solid rebeccapurple;
            background-color: #eee5f8;
            color: rebeccapurple;
            padding: 1rem 2rem;
            text-decoration: none;
            margin: 1rem 0;
        }
        a.button:hover {
            box-shadow: 8px 8px rebeccapurple;
        }
        a {
            color: rebeccapurple;
            text-decoration: none;
            border-bottom: 1px solid rebeccapurple;
        }
        a:hover {
            border-bottom: 3px solid rebeccapurple;
        }
    </style>
</head>
<body>
    <h1>Loading Priorities Scanner Bookmarklet</h1>
    <p>See a handy list of all the fetchpriorities, preloads, prefetches, and preconnects on a webpage.</p>
    <p>Drag this button to your bookmarks bar. Then when you're on the page you want to scan, click the button to generate the list. It will appear above the webpage body content.</p>
    <a class="button" role="button" href="javascript:(async function()%7Bconst%20results%20%3D%20%7B%0A%20%20priority%3A%20''%2C%0A%20%20hints%3A%20''%2C%0A%7D%0A%0Afunction%20lazyText(loadingAttr%2Cele)%20%7B%0A%20%20if%20(%20loadingAttr%20%3D%3D%3D%20%22lazy%22)%20%7B%0A%20%20%20%20return%20%22%3Cli%3E%F0%9F%94%B4%20You%20are%20lazy%20loading%20your%20LCP%20element.%3C%2Fli%3E%22%0A%20%20%7D%20else%20if%20(%2Flazyload%7Cdata-src%7Cswiper-lazy%7Cdata-rimg%7Cdata-lazy%2F.test(ele))%20%7B%0A%20%20%20%20return%20%22%3Cli%3E%F0%9F%94%B4%20You%20may%20be%20lazy%20loading%20your%20LCP%20element%20using%20a%20JavaScript%20library.%3C%2Fli%3E%22%0A%20%20%7D%20else%20%7B%0A%20%20%20%20return%20%22%3Cli%3E%F0%9F%9F%A2%20No%20lazy%20loading%20of%20the%20LCP%20element%20detected.%3C%2Fli%3E%22%0A%20%20%7D%0A%7D%0A%0Afunction%20priorityText(ele)%20%7B%0A%20%20if%20(ele.includes('fetchpriority%3D%22low%22'))%20%7B%0A%20%20%20%20return%20%22%3Cli%3E%F0%9F%94%B4%20Your%20LCP%20element%20has%20a%20low%20priority%20set.%20Try%20high%20instead.%3C%2Fli%3E%22%0A%20%20%7D%20else%20if%20(ele.includes('fetchpriority%3D%22high%22'))%20%7B%0A%20%20%20%20return%20%22%3Cli%3E%F0%9F%9F%A2%20Fetchpriority%20of%20the%20LCP%20is%20high.%3C%2Fli%3E%22%0A%20%20%7D%20else%20%7B%0A%20%20%20%20return%20%22%3Cli%3E%F0%9F%9F%A0%20Test%20whether%20adding%20a%20high%20priority%20to%20your%20LCP%20will%20make%20it%20faster.%3C%2Fli%3E%22%0A%20%20%7D%20%0A%7D%0A%0Aresults.lcp%20%3D%20await%20new%20Promise((resolve)%20%3D%3E%20%7B%0A%20%20new%20PerformanceObserver((list)%20%3D%3E%20%7B%0A%20%20%20%20const%20entries%20%3D%20list.getEntries()%3B%0A%20%20%20%20const%20lastEntry%20%3D%20entries%5Bentries.length%20-%201%5D%3B%0A%20%20%20%20const%20ele%20%3D%20lastEntry.element.outerHTML%0A%20%20%20%20let%20lis%20%3D%20%60%3Cli%3EThe%20LCP%20timing%20is%20%24%7BMath.round(lastEntry.startTime)%7Dms.%3C%2Fli%3E%60%0A%20%20%0A%20%20%20%20if%20(lastEntry.element.nodeName%20%3D%3D%3D%20%22IMG%22)%20%7B%0A%20%20%20%20%20%20%20%20lis%20%3D%20lis.concat(%0A%20%20%20%20%20%20%20%20%20%20lazyText(lastEntry.element.getAttribute(%22loading%22)%2C%20ele)%2C%0A%20%20%20%20%20%20%20%20%20%20priorityText(ele))%0A%20%20%20%20%7D%0A%20%20%20%20%0A%20%20%20%20lis%20%3D%20lis.concat(%60%3Cli%3ELCP%20HTML%3A%3C%2Fli%3E%3Cpre%20style%3D%22%22%3E%24%7Bele.replaceAll(%22%3C%22%2C%22%26lt%3B%22)%7D%3C%2Fpre%3E%60)%0A%20%20%20%20resolve(lis)%0A%20%20%7D).observe(%7B%20type%3A%20%22largest-contentful-paint%22%2C%20buffered%3A%20true%20%7D)%3B%0A%7D)%0A%0Aconst%20FETCHPRIORITY_CHECKS%20%3D%20%5B%0A%20%20%7B%0A%20%20%20%20selector%3A%20'%5Bfetchpriority%3D%22high%22%5D'%2C%0A%20%20%20%20headingText%3A%20%22Elements%20with%20fetchpriority%20set%20to%20high%3A%22%2C%0A%20%20%20%20limits%3A%20%7B%0A%20%20%20%20%20%20warn%3A%203%2C%0A%20%20%20%20%20%20error%3A%205%2C%0A%20%20%20%20%7D%0A%20%20%7D%2C%0A%20%20%7B%0A%20%20%20%20selector%3A%20'%5Bfetchpriority%3D%22low%22%5D'%2C%0A%20%20%20%20headingText%3A%20%22Elements%20with%20fetchpriority%20set%20to%20low%3A%22%0A%20%20%7D%2C%0A%5D%0A%0Afunction%20warningMsg(length%2C%20limits)%20%7B%0A%20%20let%20warning%20%3D%20''%0A%20%20if%20(length%20%3E%3D%20limits.error)%20%7B%0A%20%20%20%20warning%20%3D%20%60%3Cp%3E%F0%9F%94%B4%20You%20have%20more%20than%20%24%7Blimits.error%20-%201%7D%20which%20may%20hinder%20loading%20speed.%3C%2Fp%3E%60%0A%20%20%7D%20else%20if%20(length%20%3E%3D%20limits.warn)%20%7B%0A%20%20%20%20warning%20%3D%20%60%3Cp%3E%F0%9F%9F%A0%20You%20have%20more%20than%20%24%7Blimits.warn%20-%201%7D%20which%20may%20hinder%20loading%20speed.%3C%2Fp%3E%60%0A%20%20%7D%0A%20%20return%20warning%0A%7D%0A%0AFETCHPRIORITY_CHECKS.forEach(check%20%3D%3E%20%7B%0A%20%20const%20nodelist%20%3D%20document.querySelectorAll(check.selector)%0A%20%20const%20warning%20%3D%20check.limits%20%3F%20warningMsg(nodelist.length%2C%20check.limits)%20%3A%20''%0A%0A%20%20let%20flis%20%3D%20%5B%5D%0A%20%20nodelist.forEach(e%20%3D%3E%20%7B%0A%20%20%20%20const%20value%20%3D%20e.href%20%3F%20%60with%20href%3D%22%24%7Be.href%7D%22%60%20%3A%20%60with%20src%3D%22%24%7Be.src%7D%22%60%0A%20%20%20%20flis.push(%60%3Cli%3E%24%7Be.nodeName%7D%20%24%7Bvalue%7D%3C%2Fli%3E%60)%0A%20%20%7D)%0A%0A%20%20results.priority%20%3D%20results.priority.concat(%60%3Ch2%3E%24%7Bcheck.headingText%7D%20%24%7Bnodelist.length%7D%3C%2Fh2%3E%24%7Bwarning%7D%3Col%3E%24%7Bflis.join('')%7D%3C%2Fol%3E%60)%0A%7D)%0A%0Aconst%20CHECKS%20%3D%20%5B%0A%20%20%7B%0A%20%20%20%20selector%3A%20'link%5Brel%3D%22preload%22%5D'%2C%0A%20%20%20%20headingText%3A%20%22Preloaded%20assets%3A%22%2C%0A%20%20%20%20limits%3A%20%7B%0A%20%20%20%20%20%20warn%3A%203%2C%0A%20%20%20%20%20%20error%3A%205%2C%0A%20%20%20%20%7D%0A%20%20%7D%2C%0A%20%20%7B%0A%20%20%20%20selector%3A%20'link%5Brel%3D%22prefetch%22%5D'%2C%0A%20%20%20%20headingText%3A%20%22Prefetched%20assets%3A%22%0A%20%20%7D%2C%0A%20%20%7B%0A%20%20%20%20selector%3A%20'link%5Brel%3D%22preconnect%22%5D'%2C%0A%20%20%20%20headingText%3A%20%22Preconnected%20domains%3A%22%0A%20%20%7D%2C%0A%20%20%7B%0A%20%20%20%20selector%3A%20'link%5Brel%3D%22dns-prefetch%22%5D'%2C%0A%20%20%20%20headingText%3A%20%22DNS-prefetched%20domains%3A%22%0A%20%20%7D%0A%5D%0A%0ACHECKS.forEach(check%20%3D%3E%20%7B%0A%20%20const%20nodelist%20%3D%20document.querySelectorAll(check.selector)%0A%20%20const%20warning%20%3D%20check.limits%20%3F%20warningMsg(nodelist.length%2C%20check.limits)%20%3A%20''%0A%0A%20%20let%20flis%20%3D%20%5B%5D%0A%20%20nodelist.forEach(e%20%3D%3E%20%7B%0A%20%20%20%20const%20value%20%3D%20e.href%20%3F%20%60with%20href%3D%22%24%7Be.href%7D%22%60%20%3A%20%60with%20src%3D%22%24%7Be.src%7D%22%60%0A%20%20%20%20flis.push(%60%3Cli%3E%24%7Be.href%7D%3C%2Fli%3E%60)%0A%20%20%7D)%0A%0A%20%20results.hints%20%3D%20results.hints.concat(%60%3Ch2%3E%24%7Bcheck.headingText%7D%20%24%7Bnodelist.length%7D%3C%2Fh2%3E%24%7Bwarning%7D%3Col%3E%24%7Bflis.join('')%7D%3C%2Fol%3E%60)%0A%7D)%0A%0Aclass%20Modal%20extends%20HTMLElement%20%7B%0A%20%20static%20get%20observedAttributes()%20%7B%0A%20%20%20%20return%20%5B%22open%22%5D%3B%0A%20%20%7D%0A%0A%20%20constructor()%20%7B%0A%20%20%20%20super()%3B%0A%20%20%20%20this.attachShadow(%7B%20mode%3A%20%22open%22%20%7D)%3B%0A%20%20%20%20this.close%20%3D%20this.close.bind(this)%3B%0A%20%20%7D%0A%0A%20%20attributeChangedCallback(attrName%2C%20oldValue%2C%20newValue)%20%7B%0A%20%20%20%20if%20(oldValue%20!%3D%3D%20newValue)%20%7B%0A%20%20%20%20%20%20this%5BattrName%5D%20%3D%20this.hasAttribute(attrName)%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20connectedCallback()%20%7B%0A%20%20%20%20const%20%7B%20shadowRoot%20%7D%20%3D%20this%3B%0A%20%20%20%20shadowRoot.innerHTML%20%3D%20%60%3Cstyle%3E%0A%20%20%20%20%20%20h1%2C%20h2%2C%20p%2C%20ol%2C%20ul%20%7Bmargin-bottom%3A0%7D%0A%20%20%20%20%20%20.close%20%7B%0A%20%20%20%20%20%20%20%20position%3A%20absolute%3B%0A%20%20%20%20%20%20%20%20top%3A%200%3B%0A%20%20%20%20%20%20%20%20right%3A%200%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20.wrapper%20%7B%0A%20%20%20%20%20%20%20%20font-size%3A%2016px%3B%0A%20%20%20%20%20%20%20%20font-family%3A%20Arial%2C%20Helvetica%2C%20sans-serif%3B%0A%20%20%20%20%20%20%20%20opacity%3A%200%3B%0A%20%20%20%20%20%20%20%20transition%3A%20visibility%200s%2C%20opacity%200.25s%20ease-in%3B%0A%20%20%20%20%20%20%20%20z-index%3A%209999999%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20.wrapper%3Anot(.open)%20%7B%0A%20%20%20%20%20%20%20%20visibility%3A%20hidden%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20.wrapper.open%20%7B%0A%20%20%20%20%20%20%20%20align-items%3A%20center%3B%0A%20%20%20%20%20%20%20%20display%3A%20flex%3B%0A%20%20%20%20%20%20%20%20justify-content%3A%20center%3B%0A%20%20%20%20%20%20%20%20height%3A%20100vh%3B%0A%20%20%20%20%20%20%20%20position%3A%20fixed%3B%0A%20%20%20%20%20%20%20%20inset%3A%200%3B%0A%20%20%20%20%20%20%20%20opacity%3A%201%3B%0A%20%20%20%20%20%20%20%20visibility%3A%20visible%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20.overlay%20%7B%0A%20%20%20%20%20%20%20%20background%3A%20rgba(0%2C%200%2C%200%2C%200.8)%3B%0A%20%20%20%20%20%20%20%20height%3A%20100%25%3B%0A%20%20%20%20%20%20%20%20position%3A%20fixed%3B%0A%20%20%20%20%20%20%20%20inset%3A%200%3B%0A%20%20%20%20%20%20%20%20width%3A%20100%25%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20.dialog%20%7B%0A%20%20%20%20%20%20%20%20background%3A%20%23fff%3B%0A%20%20%20%20%20%20%20%20color%3A%20%23333%3B%0A%20%20%20%20%20%20%20%20padding%3A%202rem%3B%0A%20%20%20%20%20%20%20%20position%3A%20fixed%3B%0A%20%20%20%20%20%20%20%20inset%3A%2032px%3B%0A%20%20%20%20%20%20%20%20box-shadow%3A%200%2012px%2015px%200%20rgb(0%200%200%20%2F%2025%25)%3B%0A%20%20%20%20%20%20%20%20overflow-y%3Ascroll%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20button%20%7B%0A%20%20%20%20%20%20%20%20margin%3A%201.2rem%3B%0A%20%20%20%20%20%20%20%20padding%3A%200.25rem%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20pre%20%7B%0A%20%20%20%20%20%20%20%20overflow%3Aauto%3Bwidth%3A100%25%3Bdirection%3Altr%3Bpadding%3A0.5rem%3Btext-align%3Aleft%3Bwhite-space%3Apre-wrap%3Btab-size%3A2%3Bhyphens%3Anone%3Bbackground%3A%23222%3Bcolor%3A%23FFF%3Bfont-size%3A0.8rem%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%3C%2Fstyle%3E%0A%20%20%20%20%3Cdiv%20class%3D%22wrapper%22%3E%0A%20%20%20%20%20%20%3Cdiv%20class%3D%22overlay%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%3Cdiv%20class%3D%22dialog%22%20role%3D%22dialog%22%20aria-labelledby%3D%22title%22%20aria-describedby%3D%22content%22%3E%0A%20%20%20%20%20%20%20%20%3Cbutton%20class%3D%22close%22%3EClose%3C%2Fbutton%3E%0A%20%20%20%20%20%20%20%20%3Ch1%20id%3D%22title%22%3EPriorities%20Scanner%20Results%3C%2Fh1%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20id%3D%22content%22%20class%3D%22content%22%3E%0A%20%20%20%20%20%20%20%20%20%20%3Cp%3ERefresh%20this%20page%20to%20clear%20all%20the%20code%20from%20this%20bookmarklet.%20%3Ca%20href%3D%22https%3A%2F%2Fprojects.sia.codes%2Fpriorities-bookmarklet%2F%22%3EShare%3C%2Fa%3E%20this%20bookmarklet.%3C%2Fp%3E%0A%20%20%20%20%20%20%20%20%20%20%3Ch2%3ELCP%20Analysis%3C%2Fh2%3E%0A%20%20%20%20%20%20%20%20%20%20%3Cul%3E%24%7Bresults.lcp%7D%3C%2Ful%3E%0A%20%20%20%20%20%20%20%20%20%20%24%7Bresults.priority%7D%0A%20%20%20%20%20%20%20%20%20%20%24%7Bresults.hints%7D%0A%20%20%20%20%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3C%2Fdiv%3E%60%3B%0A%0A%20%20%20%20shadowRoot.querySelector(%22button%22).addEventListener(%22click%22%2C%20this.close)%3B%0A%20%20%20%20shadowRoot.querySelector(%22.overlay%22).addEventListener(%22click%22%2C%20this.close)%3B%0A%20%20%20%20this.open%20%3D%20this.open%3B%0A%20%20%7D%0A%0A%20%20disconnectedCallback()%20%7B%0A%20%20%20%20this.shadowRoot%0A%20%20%20%20%20%20.querySelector(%22button%22)%0A%20%20%20%20%20%20.removeEventListener(%22click%22%2C%20this.close)%3B%0A%20%20%20%20this.shadowRoot%0A%20%20%20%20%20%20.querySelector(%22.overlay%22)%0A%20%20%20%20%20%20.removeEventListener(%22click%22%2C%20this.close)%3B%0A%20%20%7D%0A%0A%20%20get%20open()%20%7B%0A%20%20%20%20return%20this.hasAttribute(%22open%22)%3B%0A%20%20%7D%0A%0A%20%20set%20open(isOpen)%20%7B%0A%20%20%20%20const%20%7B%20shadowRoot%20%7D%20%3D%20this%3B%0A%20%20%20%20shadowRoot.querySelector(%22.wrapper%22).classList.toggle(%22open%22%2C%20isOpen)%3B%0A%20%20%20%20shadowRoot.querySelector(%22.wrapper%22).setAttribute(%22aria-hidden%22%2C%20!isOpen)%3B%0A%20%20%20%20if%20(isOpen)%20%7B%0A%20%20%20%20%20%20this._wasFocused%20%3D%20document.activeElement%3B%0A%20%20%20%20%20%20this.setAttribute(%22open%22%2C%20%22%22)%3B%0A%20%20%20%20%20%20document.addEventListener(%22keydown%22%2C%20this._watchEscape)%3B%0A%20%20%20%20%20%20this.focus()%3B%0A%20%20%20%20%20%20shadowRoot.querySelector(%22button%22).focus()%3B%0A%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20this._wasFocused%20%26%26%20this._wasFocused.focus%20%26%26%20this._wasFocused.focus()%3B%0A%20%20%20%20%20%20this.removeAttribute(%22open%22)%3B%0A%20%20%20%20%20%20document.removeEventListener(%22keydown%22%2C%20this._watchEscape)%3B%0A%20%20%20%20%20%20this.close()%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20close()%20%7B%0A%20%20%20%20if%20(this.open%20!%3D%3D%20false)%20%7B%0A%20%20%20%20%20%20this.open%20%3D%20false%3B%0A%20%20%20%20%7D%0A%20%20%20%20const%20closeEvent%20%3D%20new%20CustomEvent(%22dialog-closed%22)%3B%0A%20%20%20%20this.dispatchEvent(closeEvent)%3B%0A%20%20%7D%0A%0A%20%20_watchEscape(event)%20%7B%0A%20%20%20%20if%20(event.key%20%3D%3D%3D%20%22Escape%22)%20%7B%0A%20%20%20%20%20%20this.close()%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%7D%0A%20%20%0AcustomElements.define(%22priorities-modal%22%2C%20Modal)%3B%0Aconst%20ele%20%3D%20document.createElement(%22priorities-modal%22)%0Adocument.querySelector(%22body%22).prepend(ele)%0Aele.open%20%3D%20true%7D)()%3B">
        Priorities Scanner
    </a>
    <p><small>Made with ðŸ’œ by <a href="https://sia.codes">Sia</a>. See <a href="https://github.com/siakaramalegos/priorities-bookmarklet">source code</a>.</small></p>
</body>
</html>
